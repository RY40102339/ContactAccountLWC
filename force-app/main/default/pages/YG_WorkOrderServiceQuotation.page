<apex:page standardcontroller="WorkOrder" 
           sidebar="false" docType="html" showHeader="false" standardStylesheets="false"
           applyHtmlTag="false" applyBodyTag="false" title="Service Quotation"
           renderAs="pdf">


    <apex:variable var="type" value="Service Quote" />

    <!-- Default PDF Template: A4 + letterhead -->
    <apex:composition template="PDFTemplateServiceQuote">
        <apex:define name="documentNumber">
            <!--
            Define the document number here, for example:
            ${!AppfactoryINV1__Invoice__c.AppfactoryINV1__InvoiceNumber__c}
            -->            
        </apex:define>
        <apex:define name="htmlhead">            
            <c:PDFStyle />
        </apex:define>
        <apex:define name="frontPage">   
        </apex:define>
        <apex:define name="header">            
        </apex:define>
        <apex:define name="body">
                 
            <div class="bcontent">

                <table class="yokotable" style="margin-top:-2cm">
                    <tbody>                                                        
                        <tr>
                            <td class="fieldlabel">Email:</td>
                            <td class="fieldvalue">{!WorkOrder.Contact.Email}</td>
                            <td class="fieldlabel">Date:</td>
                            <td class="fieldvalue">
                                <apex:outputText value="{0, date, d MMMM','  yyyy}">
                                    <apex:param value="{!today()}" /> 
                                </apex:outputText>
                            </td>
                        </tr>
                        <tr>
                            <td class="fieldlabel">To:</td>
                            <td class="fieldvalue">{!WorkOrder.Account.Name}</td>
                            <td class="fieldlabel">Your Reference:</td>
                            <td class="fieldvalue">{!WorkOrder.Customer_reference__c}</td>                               
                        </tr>
                        <tr>
                            <td class="fieldlabel">Attn:</td>
                            <td class="fieldvalue">{!WorkOrder.Contact.Name}</td>
                            <td class="fieldlabel">Our Reference:</td>
                            <td class="fieldvalue">{!WorkOrder.WorkOrderNumber}</td>
                        </tr>
                    </tbody>
                </table>

                <p>{!IF(WorkOrder.Contact.Salutation__c = '', 'Dear Mr./Ms.'+WorkOrder.Contact.LastName,WorkOrder.Contact.Salutation__c)}</p>
                <p>We hereby send you our price quotation for the services of below mentioned instrument:</p>

                <table class="yokotable">
                    <tbody>                                                        
                        <tr>
                            <td class="fieldlabelbody">Model Code:</td>
                            <td class="fieldvaluebody">{!WorkOrder.Asset.Name}</td>
                        </tr>
                        <tr>
                            <td class="fieldlabelbody">Serial Number:</td>
                            <td class="fieldvaluebody">{!WorkOrder.Asset.SerialNumber}</td>                           
                        </tr>
                        <tr>
                            <td class="fieldlabelbody">Compliant:</td>
                            <td class="fieldvaluebody">{!WorkOrder.Subject}</td>                                
                        </tr>
                    </tbody>
                </table>

                <p style="font-weight:bold;">Records of services to be rendered:</p>

                <p>{!WorkOrder.Service_Action_To_Be_Taken__c}</p>
                
                <table class="parts-table">
                    <tbody>
                        <tr>
                            <th style="width:20%;">Part No.:</th>
                            <th style="width:40%;">Description:</th>
                            <th style="width:5%;">Qty.:</th>
                            <th style="width:10%;">Type:</th>
                            <th style="width:10%;">Price:</th>
                            <th style="width:15%;">Total:</th>
                        </tr>
                        
                        <apex:repeat value="{!WorkOrder.WorkOrderLineItems}" var="sp">                       
                            <tr>
                                <td>{!sp.Part_Number__c}</td>
                                <td>{!sp.Description}</td>
                                <td>{!sp.Quantity__c}</td>
                                <td>{!sp.Type__c}</td>
                                <td style="text-align:right;">
                                    <!-- <apex:outputText value="{0, number,###,##0.00}">
                                        <apex:param value="{!sp.Price__c}"/>
                                    </apex:outputText> -->
                                    {!IF(blankvalue(sp.UnitPrice__c,0) < 0, "-", "") & IF(ABS(blankvalue(sp.UnitPrice__c,0)) >= 1000000, TEXT(FLOOR(ABS(blankvalue(sp.UnitPrice__c,0)) / 1000000)) & ".", "") & IF(ABS(blankvalue(sp.UnitPrice__c,0)) >= 1000, RIGHT(TEXT(FLOOR(ABS(blankvalue(sp.UnitPrice__c,0)) / 1000)), 3) & ".", "") & RIGHT(TEXT(FLOOR(ABS(blankvalue(sp.UnitPrice__c,0)))), 3) & "," & IF(MOD(ABS(blankvalue(sp.UnitPrice__c,0)) , 1) * 100 < 10, "0" & TEXT(ROUND(MOD(ABS(blankvalue(sp.UnitPrice__c,0)) , 1), 2) * 100), TEXT(MIN(ROUND(MOD(ABS(blankvalue(sp.UnitPrice__c,0)) , 1), 2) * 100, 99)))}
                                </td>

                                <td style="text-align:right;">
                                    {!IF(blankvalue(sp.Total__c,0) < 0, "-", "") & IF(ABS(blankvalue(sp.Total__c,0)) >= 1000000, TEXT(FLOOR(ABS(blankvalue(sp.Total__c,0)) / 1000000)) & ".", "") & IF(ABS(blankvalue(sp.Total__c,0)) >= 1000, RIGHT(TEXT(FLOOR(ABS(blankvalue(sp.Total__c,0)) / 1000)), 3) & ".", "") & RIGHT(TEXT(FLOOR(ABS(blankvalue(sp.Total__c,0)))), 3) & "," & IF(MOD(ABS(blankvalue(sp.Total__c,0)) , 1) * 100 < 10, "0" & TEXT(ROUND(MOD(ABS(blankvalue(sp.Total__c,0)) , 1), 2) * 100), TEXT(MIN(ROUND(MOD(ABS(blankvalue(sp.Total__c,0)) , 1), 2) * 100, 99)))}
                                </td>
                            </tr>                            
                        </apex:repeat>    
                                    
                    </tbody>
                </table>
    
                <table style="width: 100%;border:1px #ddd solid;font-size:11px;margin-bottom:25px;">
                    <tbody>
                        <tr>
                            <td>Total excl. VAT:</td>
                            <td style="text-align: right;">{!IF(WorkOrder.CurrencyIsoCode = 'USD','$',IF(WorkOrder.CurrencyIsoCode = 'GBP','£','€'))} 
                {!IF(blankvalue(WorkOrder.PartsTotal__c,0) < 0, "-", "") & IF(ABS(blankvalue(WorkOrder.PartsTotal__c,0)) >= 1000000, TEXT(FLOOR(ABS(blankvalue(WorkOrder.PartsTotal__c,0)) / 1000000)) & ".", "") & IF(ABS(blankvalue(WorkOrder.PartsTotal__c,0)) >= 1000, RIGHT(TEXT(FLOOR(ABS(blankvalue(WorkOrder.PartsTotal__c,0)) / 1000)), 3) & ".", "") & RIGHT(TEXT(FLOOR(ABS(blankvalue(WorkOrder.PartsTotal__c,0)))), 3) & "," & IF(MOD(ABS(blankvalue(WorkOrder.PartsTotal__c,0)) , 1) * 100 < 10, "0" & TEXT(ROUND(MOD(ABS(blankvalue(WorkOrder.PartsTotal__c,0)) , 1), 2) * 100), TEXT(MIN(ROUND(MOD(ABS(blankvalue(WorkOrder.PartsTotal__c,0)) , 1), 2) * 100, 99)))}
                                
                            </td>
                        </tr>
                    </tbody>
                </table>
                <p >Additional Comments:<br/><br/>
                    <!--If you would like to send your instrument(s) for calibration, please send us prior the completed CRF form and your order by reply email, we will provide you with our reference number and a time slot for the calibration. We cannot accept your order, if the CRF form is missing a mandatory field. Only after receipt of your order we will be able to confirm the time slot in our calibration planning.<br/><br/>
                    Our standard delivery time is 10 working days as of receipt of the unit and as from given time slot, excluding shipment.<br/><br/>
                    If before or during the calibration any defect or other phenomenon occurs that will lead to an increase of the price, we will contact you immediately to discuss how to proceed. For units without a communication bus, a special calibration price is applicable.<br/><br/>
                    We recommend you to store your user settings before shipping the instrument to us as they may be changed during calibration. Example calibration certificates can be found on: <a href="http://tmi.yokogawa.com/bx/service-support/calibration" target="_blank">http://tmi.yokogawa.com/bx/service-support/calibration</a>.<br/><br/>
                    For the best support please send all your correspondence to <a href="mailto:csc.calibration@nl.yokogawa.com">csc.calibration@nl.yokogawa.com</a> with reference to the Call ID.  -->     
                    {!WorkOrder.ServiceLocation__r.Terms_and_Conditions__c}  
                </p>

                <br/><br/>
                <table class="yokotable">
                    <tr>
                        <td style="width=60%" class="signature">Kind regards,<br/><br/></td>
                        <td style="width=40%" class="signature"></td>
                    </tr>
                    <tr>
                        <td class="signature">
                           {!WorkOrder.ServiceLocation__r.OfficeFormalName__c}
                        </td>
                        <td class="signature">
                            Your approval:
                        </td>
                    </tr>
                </table>
            </div>
        </apex:define>
        <apex:define name="footer">
        </apex:define>

        <!--apex:define name="backPage">
            <div class="endPage"/>
            <div class="resetPageCounter"/>
            <apex:include pageName="FooterPage"/>
        </apex:define--> 
    
    </apex:composition>
</apex:page>